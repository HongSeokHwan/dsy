# Chapter4 제어 유니트

# 제어 유니트의 기능

제어 유니트의 기능은 크게 2가지다.
* 명령어 코드의 해독
* 명령어 실행에 필요한 제어 신호들의 발생

명령어 코드를 해독해서 그 명령어가 실행되기 위해 각각의 하드웨어 모듈에게 
제어 신호들을 발생시키는 역할을 한다. 오케스트라로 치면 지휘자의 역할을 
한다고 볼 수 있다.

# 제어 유니트의 구조

제어 유니트의 내부 구조
* 명령어 해독기 : From 명령어 레지스터(IR) -> 명령어의 연산 코드 해독 -> 
                 해당 연산을 수행하기 위한 루틴의 시작주소 결정
* 제어 주소 레지스터 : 다음 실행할 마이크로 명령어의 주소를 저장하는 레지스터
                     (제어 기억장치의 특정 위치 가리킴)
* 제어 기억장치 : 마이크로명령어들로 이루어진 마이크로 프로그램을 저장하는 
                 내부 기억장치(ROM로 만들어져 CPU 칩 내에 포함)
* 제어 버퍼 레지스터 : 제어 기억장치로부터 읽혀진 마이크로명령어를 일시적으로
                     저장하는 레지스터 
* 서브루틴 레지스터 : 마이크로 프로그램에서 서브루틴이 호출되는 경우, 
                     현재의 CAR 내용을 일시적으로 저장하는 레지스터
* 순서제어 모듈 : 마이크로명령어의 실행 순서를 결정하는 회로들의 집합

인출 사이클

From 명령어 레지스터 -> 명령어 비트들 
                        -> 그 중 연산 코드 부분 -> 제어 유니트의 명령어 해독기

명령어 해독

명령어 해독기 -> 연산 코드를 이용하여 제어 기억장치 내 해당 실행 사이클 루틴의
시작 주소 탐색 

ex) 사상 방식 이용

명령어 코드
xxxx | 1 | 10100110010
-> 사상 함수 : 1 xxxx 00
-> ex) LOAD의 연산 코드 : '0001' -> 1000100 -> 64 + 4 => 68

실행 사이클

연산 코드가 지정하는 연산 -> 제어 기억장치에 저장된 해당 루틴 실행

# 마이크로명령어의 형식

마이크로명령어(in 제어 기억장치)

연산 필드1(3) | 연산 필드2(3) | 조건 필드(2) | 분기 필드(2) | 주소 필드(8)

총 길이 : 18비트 
연산 필드 : 마이크로 연산
조건 필드 : 분기에 사용될 조건 플래그 지정
분기 필드 : 분기의 종류와 다음에 실행할 마이크로명령어의 주소를 결정
주소 필드 : 분기가 발생하는 경우 목적지 마이크로 명령어 주소
(주소 내용의 필드가 CAR로 적재됨)

# 마이크로프로그램의 순서 제어

제어 유니트의 실행 제어 : 제어 기억장치에 저장된 해당 마이크로명령어들을
순서대로 인출하는 동작

마이크로명령어 읽어들이기 -> 연산 필드에 있는 비트들 출력 
-> 그 비트 자체가 제어 신호

제어 유닛이 명령어 실행을 제어하는 과정(상세)

제어 기억장치 내 특정 모듈에서 다음에 실행할 마이크로 명령어 주소를 결정
(이 모듈에서 핵심은 CAR 즉 제어 주소 레지스터)
-> CPU가 처음 동작을 시작하는 순간에 CAR은 '0'으로 세트 / 제어 기억장치의
0번지에 있는 인출 사이클 루틴의 첫 번째 마이크로 명령어를 인출
-> 마이크로프로그램 실행

조건(C) 

인출된 마이크로 명령어 From 제어 기억장치 -> 명령어 비트 중 CD(조건) 필드의 두 비트
-> MUX2(멀티플렉서) -> 네 개의 조건 비트들 중의 하나를 선택 -> 
선택된 출력 as input -> 주소 선택 회로 

BR(I0 / I1)

BR 필드의 두 비트 as 주소 선택 회로의 다른 두 입력 -> 주소 선택 회로

C와 BR의 I0, I1 조합 -> 주소 결정 -> CAR에 적재

ex) BR 필드 : 00(JUMP) / 01(CALL) 
-> 조건 만족x(C = 0) 이면 CAR 내용 1 증가
-> 조건 만족x(C = 0) 이면 목적지 주소인 ADF(주소 필드값) -> CAR에 적재






