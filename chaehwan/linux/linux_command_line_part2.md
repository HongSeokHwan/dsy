# The Linux Command Line Part2 - Configuration and Environment

# Chapter11. The Environment

쉘은 쉘 세션이 진행되는 동안 모든 정보를 관리하느 환경을 유지한다.
대분의 프로그램은 환경설정 파일을 사용하지만, 일부 프로그램은 동작하기
위해 환경에 설정된 값을 찾아보기도 한다.

## 환경에는 어떤 것들이 저장될까?

bash에서는 구분하기 힘들지만 shell은 환경에 두 가지 기본적인 형식을
저장한다.
* 쉘 변수 : bash에 의해 저장된 작은 데이터
* 환경 변수 : 그 밖의 모든 것

### 환경 검증하기

* 환경에 저장된 것이 무엇인지 보려면 bash에 내장된 set 명령어나 
  printenv 프로그램을 사용하면 됨
* set 명령어는 shell 변수와 환경 변수를 모두 보여주며, printenv는
  오직 환경변수만을 출력한다.
  (환경 변수 내용이 상당히 길기 때문에 파이프라인을 활용해서 less
  명령어를 사용하는 것이 좋다.)
* echo $HOME 와 같이 echo 명령으로 변수 내용을 보는 것도 가능하다.
* set과 printenv 명령어도 alias는 표시하지 않는다.

### 흥미로운 변수들

환경 변수에는 수많은 변수 있음
ex) 
HOME : 홈 디렉토리 경로명 
LANG : 사용자 언어의 문자셋과 정렬방식
...

## 환경은 어떻게 설정할까?

시스템에 로그인하면 bash 프로그램이 시작되면서 시작 파일(startup files)이라고 
하는 일련의 환경 설정 스크립트를 읽는다. 이 시작 파일은 모든 사용자에게 공유되는
기본적인 환경 설정 값을 규정한다.

### 로그인 여부에 따른 쉘 환경

쉘 세션의 종류
* 로그인 쉘 세션 : 사용자 이름과 비밀번호를 입력하도록 되어 있음
    * /etc/profile : 모든 사용자에게 적용되는 일반 환경설정
    * ~/.bash_profile : 개인 사용자 시작 파일
    * ~/.bash_login : ~/.bash_profile 파일이 없으면 bash는 이 스크립트 읽음
    * ~/.profile : ~/.bash_profile 이나 ~/.bash_login이 없으면 bash는 이 파일을 
    읽음
* 비로그인 쉘 세션 : 일반적으로 GUI 환경에서 터미널 세션을 실행할 때 나타남
    * /etc/bash.bashrc : 모든 사용자에게 적용되는 일반 환경설정
    * ~/.bashrc : 개인 사용자 시작 파일. 일반 환경설정을 확장하거나 무시할 수 있음

비로그인 쉘은 이 시작 파일을 읽는 것뿐만 아니라 주로 로그인 쉘과 같은 상위 프로세스로부터
환경값을 물려받는다.

로그인용 쉘용의 시작파일의 대부분은 ~/.bashrc 파일을 기본적으로 참조하도록 만들어져 있다.

### 시작 파일에는 어떤 것들이 있을까?

참고) 커맨드라인에 명령어를 입력하면 shell은 컴퓨터 전체를 검색하는 것이 아니라 PATH라는
변수에 있는 디렉토리를 대상으로만 검색하고 결과를 반환한다.

## 환경 편집

### 어떤 파일을 수정해야 할까?

* 일반적으로 사용자의 path에 디렉토리를 추가하거나 부가적인 환경 변수를 정의하기 위해서는
.bash_profile 파일을 수정해야 한다.
* 다른 것들은 .bashrc 파일에서 변경한다. (시스템 관리자가 아니라면 홈 디렉토리에 있는 파일만
을 편집하도록 한다.)

참고) 중요한 설정 파일을 편집할 때는 항상 백업 파일을 만들어두는 것이 좋다.

```bash
cp .bashrc .bashrc.bak
```

### 변경사항 적용하기

.bashrc 파일에 편집한 내용들은 터미널 세션을 종료하고 다시 새로 실행할 때까지 적용되지 않는다.
왜냐하면 .bashrc 파일은 최초 세션이 시작될 때 참조되는 파일이기 때문이다. 하지만 bash에 강제로
이 파일을 참조하도록 하는 방법도 있다.

```bash
source .bashrc
```

참고) 환경설정 파일을 수정할 때마다 변경사항을 설명해주는 주석을 다는 것이 좋다. 
3개월이나 6개월 정도 흘렀을 때는 무엇을 수정했는지 파악하기가 쉽지 않다.


# Chapter12. A Gentle Introduction to vi

vi를 왜 배워야 할까?
* 어디에서나 사용할 수 있다.
* 가볍고 빠르다.

(기본적인 내용은 생략)

## 전체 검색 및 치환

:%s/Line/line/g
* % : 작업을 수행할 범위 -> 첫 줄부터 마지막 줄
* s : 작업을 지정 -> 여기서는 치환 작업
* /Line/line/ : 검색 패턴과 바꾸고자 하는 텍스트
* g : 전체를 의미 -> g를 사용하지 않으면 각 줄마다 첫 번째
검색 문자열만 변경

:%s/Line/line/gc 
* c를 추가해주면 사용자 확인 메세지를 표시하는 치환 명령어 사용
* replace with Line (y/n/a/q/l/^E/^Y) 와 같은 메세지 뜸
    * y : 치환 실행
    * n : 이번 치환 건너뛰기
    * a : 전체 치환 실행
    * q : 치환 중단
    * l : 이번 치환 후 중단
    * Ctrl + E, Ctrl + Y : 스크롤 위 아래로 이동하기, 치환 내용 확인 시 유용

## 다중 파일 편집

한 번에 하나 이상의 파일을 수정할 때 유용 
ex) 여러 파일을 수정해야 할 경우나 한 파일에서 다른 파일로 내용을 복사해야 할 경우 

vi file1 file2 file3 ...

## 파일 간 전환

파일 간 전환은 다음 파일을 가려면

:n

이전 파일로 되돌아가려면

:N

현재 파일을 저장하지 않으면 전환이 불가능하도록 되어 있는데

:n!

저장하지 않고 강제로 전환하려면 위처럼 !를 붙여주면 된다.

수정 중인 파일의 목록을 보려면 

:buffers

위와 같이 입력하면 된다.
전환하려면

:buffer 2

와 같이 파일 번호를 붙여주면 전환이 가능하다.

## 다른 파일 열어서 편집

하나의 파일을 열어둔 상황에서 다른 파일을 열어서 작업하는 것도 가능하다.

vim foo.txt 

위 명령어를 통해 하나의 파일을 열어둔 상황에서

:e ls-output.txt

위와 같이 입력하면 ls-output.txt 파일이 열리는 것을 확인할 수 있다.
:buffers 명령어로 확인하면 두 개의 파일이 수정중인 것을 알 수 있다.

주의사항은 이렇게 파일을 열면 :n, :N 와 같은 명령어로 전환하는 것이
불가능하다. :buffer 2로 같이 번호를 명시해서 전환해야 한다.

## 파일 내용을 다른 파일로 복사

:buffer 1
으로 1번 파일로 가서 yy로 한 줄을 복사한 다음
:buffer 2
로 가서 원하는 위치에 p를 누르면 붙여넣기가 되는 것을 알 수 있다.

## 파일 전체를 다른 파일에 삽입

:vi ls-output.txt

위 명령어로 하나의 파일에서 작업하다가 특정 위치로 가서
다음 명령어를 입력하면 foo.txt의 파일 내용 전체가 복사되는 것을
확인할 수 있다.(r은 read의 준말이다.)

:r foo.txt

## 저장하기

:w 로 저장하는 방법도 있지만 일반 모드에서 ZZ을 입력하면 현재 파일을
저장하고 종료한다.

그리고 :w foo1.txt와 같이 다른 이름으로 저장하는 기능이 있는 것도 기억하자.

# Chapter13. Customizing The Prompt 

## 프롬프트 해부하기

프롬프트는 PS1(Prompt String1)이라는 환경 변수에 의해 정의된다.
다음 명령어로 내용을 확인할 수 있다.

```bash
echo $PS1
```

## 다른 형태의 프롬프트 사용해보기

환경 변수를 백업해두고 PS1 환경 변수를 조작해서 커스터마이징할 수 있다.

```bash
# backup
ps1_old="$PS1"
echo $ps1_old
# rollbask
PS1="$ps1_old"
```

## 프롬프트 저장

매번 설정을 변경하지 않으려면
.bashrc 파일에서 

```bash
PS1="~"
export PS1
```

위에서 ~ 부분을 채운 다음 export하면 계속 사용이 가능하다.
